!function(f){function C(){return"Markdown.mk_block( "+uneval(this.toString())+", "+uneval(this.trailing)+", "+uneval(this.lineNumber)+" )"}function e(){var a=require("util");return"Markdown.mk_block( "+a.inspect(this.toString())+", "+a.inspect(this.trailing)+", "+a.inspect(this.lineNumber)+" )"}function m(a){for(var b=0,c=-1;-1!==(c=a.indexOf("\n",c+1));)b++;return b}function k(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}
function n(a){if("string"==typeof a)return k(a);var b=a.shift(),c={},d=[];for(!a.length||"object"!=typeof a[0]||a[0]instanceof Array||(c=a.shift());a.length;)d.push(n(a.shift()));a="";for(var h in c)a+=" "+h+'="'+k(c[h])+'"';return"img"===b||"br"===b||"hr"===b?"<"+b+a+"/>":"<"+b+a+">"+d.join("")+"</"+b+">"}function t(a,b,c){var d;c=c||{};a=a.slice(0);"function"==typeof c.preprocessTreeNode&&(a=c.preprocessTreeNode(a,b));var h=p(a);if(h){a[1]={};for(d in h)a[1][d]=h[d];h=a[1]}if("string"==typeof a)return a;
switch(a[0]){case "header":a[0]="h"+a[1].level;delete a[1].level;break;case "bulletlist":a[0]="ul";break;case "numberlist":a[0]="ol";break;case "listitem":a[0]="li";break;case "para":a[0]="p";break;case "markdown":a[0]="html";h&&delete h.references;break;case "code_block":a[0]="pre";d=h?2:1;var e=["code"];e.push.apply(e,a.splice(d,a.length-d));a[d]=e;break;case "inlinecode":a[0]="code";break;case "img":a[1].src=a[1].href;delete a[1].href;break;case "linebreak":a[0]="br";break;case "link":a[0]="a";
break;case "link_ref":a[0]="a";d=b[h.ref];if(!d)return h.original;delete h.ref;h.href=d.href;d.title&&(h.title=d.title);delete h.original;break;case "img_ref":a[0]="img";d=b[h.ref];if(!d)return h.original;delete h.ref;h.src=d.href;d.title&&(h.title=d.title);delete h.original}if(d=1,h){for(var f in a[1]){d=2;break}1===d&&a.splice(d,1)}for(;d<a.length;++d)a[d]=t(a[d],b,c);return a}function E(a){for(var b=p(a)?2:1;b<a.length;)"string"==typeof a[b]?b+1<a.length&&"string"==typeof a[b+1]?a[b]+=a.splice(b+
1,1)[0]:++b:(E(a[b]),++b)}function s(a,b){function c(a){this.len_after=a;this.name="close_"+b}var d=a+"_state",h="strong"===a?"em_state":"strong_state";return function(e){if(this[d][0]===b)return this[d].shift(),[e.length,new c(e.length-b.length)];var f=this[h].slice(),m=this[d].slice();this[d].unshift(b);var B=this.processInline(e.substr(b.length)),g=B[B.length-1];return(this[d].shift(),g instanceof c)?(B.pop(),[e.length-g.len_after,[a].concat(B)]):(this[h]=f,this[d]=m,[b.length,b])}}var l,v,D,y;
l=function(a,b,c){1===arguments.length&&(b="\n\n");var d=new String(a);return d.trailing=b,d.inspect=e,d.toSource=C,void 0!==c&&(d.lineNumber=c),d};var w=v=Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)};D=Array.prototype.forEach?function(a,b,c){return a.forEach(b,c)}:function(a,b,c){for(var d=0;d<a.length;d++)b.call(c||a,a[d],d,a)};y=function(a){return w(a)&&1<a.length&&"object"==typeof a[1]&&!w(a[1])?a[1]:void 0};var g=function(a){switch(typeof a){case "undefined":this.dialect=
g.dialects.Gruber;break;case "object":this.dialect=a;break;default:if(!(a in g.dialects))throw Error("Unknown Markdown dialect '"+String(a)+"'");this.dialect=g.dialects[a]}this.em_state=[];this.strong_state=[];this.debug_indent=""};g.dialects={};var q=g.mk_block=l,w=v;g.parse=function(a,b){return(new g(b)).toTree(a)};g.prototype.split_blocks=function(a){a=a.replace(/(\r\n|\n|\r)/g,"\n");var b,c=/([\s\S]+?)($|\n#|\n(?:\s*\n|$)+)/g,d=[],h=1;for(null!==(b=/^(\s*\n)/.exec(a))&&(h+=m(b[0]),c.lastIndex=
b[0].length);null!==(b=c.exec(a));)"\n#"===b[2]&&(b[2]="\n",c.lastIndex--),d.push(q(b[1],b[2],h)),h+=m(b[0]);return d};g.prototype.processBlock=function(a,b){var c=this.dialect.block,d=c.__order__;if("__call__"in c)return c.__call__.call(this,a,b);for(var h=0;h<d.length;h++){var e=c[d[h]].call(this,a,b);if(e)return(!w(e)||0<e.length&&!w(e[0]))&&this.debug(d[h],"didn't return a proper array"),e}return[]};g.prototype.processInline=function(a){return this.dialect.inline.__call__.call(this,String(a))};
g.prototype.toTree=function(a,b){var c=a instanceof Array?a:this.split_blocks(a),d=this.tree;try{for(this.tree=b||this.tree||["markdown"];c.length;){var h=this.processBlock(c.shift(),c);h.length&&this.tree.push.apply(this.tree,h)}return this.tree}finally{b&&(this.tree=d)}};g.prototype.debug=function(){var a=Array.prototype.slice.call(arguments);a.unshift(this.debug_indent);"undefined"!=typeof print&&print.apply(print,a);"undefined"!=typeof console&&"undefined"!=typeof console.log&&console.log.apply(null,
a)};g.prototype.loop_re_over_block=function(a,b,c){var d;for(b=b.valueOf();b.length&&null!==(d=a.exec(b));)b=b.substr(d[0].length),c.call(this,d);return b};g.buildBlockOrder=function(a){var b=[],c;for(c in a)"__order__"!==c&&"__call__"!==c&&b.push(c);a.__order__=b};g.buildInlinePatterns=function(a){var b=[],c;for(c in a)if(!c.match(/^__.*__$/)){var d=c.replace(/([\\.*+?|()\[\]{}])/g,"\\$1").replace(/\n/,"\\n");b.push(1===c.length?d:"(?:"+d+")")}b=b.join("|");a.__patterns__=b;var h=a.__call__;a.__call__=
function(a,c){return void 0!==c?h.call(this,a,c):h.call(this,a,b)}};var p=y;g.renderJsonML=function(a,b){b=b||{};b.root=b.root||!1;var c=[];if(b.root)c.push(n(a));else for(a.shift(),!a.length||"object"!=typeof a[0]||a[0]instanceof Array||a.shift();a.length;)c.push(n(a.shift()));return c.join("\n\n")};g.toHTMLTree=function(a,b,c){"string"==typeof a&&(a=this.parse(a,b));b=p(a);var d={};b&&b.references&&(d=b.references);a=t(a,d,c);return E(a),a};g.toHTML=function(a,b,c){a=this.toHTMLTree(a,b,c);return this.renderJsonML(a)};
v={inline_until_char:function(a,b){for(var c=0,d=[];;){if(a.charAt(c)===b)return c++,[c,d];if(c>=a.length)return null;var h=this.dialect.inline.__oneElement__.call(this,a.substr(c)),c=c+h[0];d.push.apply(d,h.slice(1))}},subclassDialect:function(a){function b(){}function c(){}return b.prototype=a.block,c.prototype=a.inline,{block:new b,inline:new c}}};var z=D,p=y,q=l,F=v.inline_until_char;l={block:{atxHeader:function(a,b){var c=a.match(/^(#{1,6})\s*(.*?)\s*#*\s*(?:\n|$)/);if(c){var d=["header",{level:c[1].length}];
return Array.prototype.push.apply(d,this.processInline(c[2])),c[0].length<a.length&&b.unshift(q(a.substr(c[0].length),a.trailing,a.lineNumber+2)),[d]}},setextHeader:function(a,b){var c=a.match(/^(.*)\n([-=])\2\2+(?:\n|$)/);if(c){var d=["header",{level:"="===c[2]?1:2},c[1]];return c[0].length<a.length&&b.unshift(q(a.substr(c[0].length),a.trailing,a.lineNumber+2)),[d]}},code:function(a,b){var c=[],d=/^(?: {0,3}\t| {4})(.*)\n?/;if(a.match(d)){a:for(;;){var h=this.loop_re_over_block(d,a.valueOf(),function(a){c.push(a[1])});
if(h.length){b.unshift(q(h,a.trailing));break a}if(!b.length)break a;if(!b[0].match(d))break a;c.push(a.trailing.replace(/[^\n]/g,"").substring(2));a=b.shift()}return[["code_block",c.join("\n")]]}},horizRule:function(a,b){var c=a.match(/^(?:([\s\S]*?)\n)?[ \t]*([-_*])(?:[ \t]*\2){2,}[ \t]*(?:\n([\s\S]*))?$/);if(c){var d=[["hr"]];if(c[1]){var h=q(c[1],"",a.lineNumber);d.unshift.apply(d,this.toTree(h,[]))}return c[3]&&b.unshift(q(c[3],a.trailing,a.lineNumber+1)),d}},lists:function(){function a(a){return new RegExp("(?:^("+
g+"{0,"+a+"} {0,3})("+h+")\\s+)|(^"+g+"{0,"+(a-1)+"}[ ]{0,4})")}function b(a,b,c,d){if(b)return a.push(["para"].concat(c)),void 0;b=a[a.length-1]instanceof Array&&"para"===a[a.length-1][0]?a[a.length-1]:a;d&&1<a.length&&c.unshift(d);for(a=0;a<c.length;a++)d=c[a],"string"==typeof d&&1<b.length&&"string"==typeof b[b.length-1]?b[b.length-1]+=d:b.push(d)}function c(a,b){for(var c=new RegExp("^("+g+"{"+a+"}.*?\\n?)*$"),d=new RegExp("^"+g+"{"+a+"}","gm"),h=[];0<b.length&&c.exec(b[0]);){var e=b.shift(),
f=e.replace(d,"");h.push(q(f,e.trailing,e.lineNumber))}return h}function d(a,b,c){a=a.list;a=a[a.length-1];a[1]instanceof Array&&"para"===a[1][0]||(b+1===c.length?a.push(["para"].concat(a.splice(1,a.length-1))):(b=a.pop(),a.push(["para"].concat(a.splice(1,a.length-1)),b)))}var h="[*+-]|\\d+\\.",e=/[*+-]/,f=new RegExp("^( {0,3})("+h+")[ \t]+"),g="(?: {0,3}\\t| {4})";return function(h,g){function m(a){var b=e.exec(a[2])?["bulletlist"]:["numberlist"];return l.push({list:b,indent:a[1]}),b}var k=h.match(f);
if(k){for(var u,n,l=[],p=m(k),r=!1,q=[l[0].list];;){for(var t=h.split(/(?=\n)/),x="",s="",v=0;v<t.length;v++){var s="",w=t[v].replace(/^\n/,function(a){return s=a,""});n=a(l.length);if(k=w.match(n),void 0!==k[1]){x.length&&(b(u,r,this.processInline(x),s),r=!1,x="");k[1]=k[1].replace(/ {0,3}\t/g,"    ");var A=Math.floor(k[1].length/4)+1;if(A>l.length)p=m(k),u.push(p),u=p[1]=["listitem"];else{var y=!1;for(n=0;n<l.length;n++)if(l[n].indent===k[1]){p=l[n].list;l.splice(n+1,l.length-(n+1));y=!0;break}y||
(A++,A<=l.length?(l.splice(A,l.length-A),p=l[A-1].list):(p=m(k),u.push(p)));u=["listitem"];p.push(u)}s=""}w.length>k[0].length&&(x+=s+w.substr(k[0].length))}x.length&&(b(u,r,this.processInline(x),s),r=!1,x="");r=c(l.length,g);0<r.length&&(z(l,d,this),u.push.apply(u,this.toTree(r,[])));r=g[0]&&g[0].valueOf()||"";if(!r.match(f)&&!r.match(/^ /))break;h=g.shift();if(r=this.dialect.block.horizRule(h,g)){q.push.apply(q,r);break}z(l,d,this);r=!0}return q}}}(),blockquote:function(a,b){if(a.match(/^>/m)){var c=
[];if(">"!==a[0]){for(var d=a.split(/\n/),h=[],e=a.lineNumber;d.length&&">"!==d[0][0];)h.push(d.shift()),e++;h=q(h.join("\n"),"\n",a.lineNumber);c.push.apply(c,this.processBlock(h,[]));a=q(d.join("\n"),a.trailing,e)}for(;b.length&&">"===b[0][0];)d=b.shift(),a=q(a+a.trailing+d,d.trailing,a.lineNumber);d=a.replace(/^> ?/gm,"");d=(this.tree,this.toTree(d,["blockquote"]));if((e=p(d))&&e.references){delete e.references;var f;a:{for(f in e)if(hasOwnProperty.call(e,f)){f=!1;break a}f=!0}f&&d.splice(1,1)}return c.push(d),
c}},referenceDefn:function(a,b){var c=/^\s*\[(.*?)\]:\s*(\S+)(?:\s+(?:(['"])(.*?)\3|\((.*?)\)))?\n?/;if(a.match(c)){p(this.tree)||this.tree.splice(1,0,{});var d=p(this.tree);void 0===d.references&&(d.references={});c=this.loop_re_over_block(c,a,function(a){a[2]&&"<"===a[2][0]&&">"===a[2][a[2].length-1]&&(a[2]=a[2].substring(1,a[2].length-1));var b=d.references[a[1].toLowerCase()]={href:a[2]};void 0!==a[4]?b.title=a[4]:void 0!==a[5]&&(b.title=a[5])});return c.length&&b.unshift(q(c,a.trailing)),[]}},
para:function(a){return[["para"].concat(this.processInline(a))]}},inline:{__oneElement__:function(a,b,c){var d,e;b=b||this.dialect.inline.__patterns__;return(d=(new RegExp("([\\s\\S]*?)("+(b.source||b)+")")).exec(a),d)?d[1]?[d[1].length,d[1]]:(d[2]in this.dialect.inline&&(e=this.dialect.inline[d[2]].call(this,a.substr(d.index),d,c||[])),e||[d[2].length,d[2]]):[a.length,a]},__call__:function(a,b){function c(a){"string"==typeof a&&"string"==typeof e[e.length-1]?e[e.length-1]+=a:e.push(a)}for(var d,
e=[];0<a.length;)d=this.dialect.inline.__oneElement__.call(this,a,b,e),a=a.substr(d.shift()),z(d,c);return e},"]":function(){},"}":function(){},__escape__:/^\\[\\`\*_{}\[\]()#\+.!\-]/,"\\":function(a){return this.dialect.inline.__escape__.exec(a)?[2,a.charAt(1)]:[1,"\\"]},"![":function(a){var b=a.match(/^!\[(.*?)\][ \t]*\([ \t]*([^")]*?)(?:[ \t]+(["'])(.*?)\3)?[ \t]*\)/);return b?(b[2]&&"<"===b[2][0]&&">"===b[2][b[2].length-1]&&(b[2]=b[2].substring(1,b[2].length-1)),b[2]=this.dialect.inline.__call__.call(this,
b[2],/\\/)[0],a={alt:b[1],href:b[2]||""},void 0!==b[4]&&(a.title=b[4]),[b[0].length,["img",a]]):(b=a.match(/^!\[(.*?)\][ \t]*\[(.*?)\]/),b?[b[0].length,["img_ref",{alt:b[1],ref:b[2].toLowerCase(),original:b[0]}]]:[2,"!["])},"[":function(a){var b=String(a),c=F.call(this,a.substr(1),"]");if(!c)return[1,"["];var d,e,f=1+c[0],c=c[1];a=a.substr(f);var g=a.match(/^\s*\([ \t]*([^"']*)(?:[ \t]+(["'])(.*?)\2)?[ \t]*\)/);if(g){a=g[1];if(f+=g[0].length,a&&"<"===a[0]&&">"===a[a.length-1]&&(a=a.substring(1,a.length-
1)),!g[3])for(var b=1,m=0;m<a.length;m++)switch(a[m]){case "(":b++;break;case ")":0===--b&&(f-=a.length-m,a=a.substring(0,m))}return a=this.dialect.inline.__call__.call(this,a,/\\/)[0],e={href:a||""},void 0!==g[3]&&(e.title=g[3]),d=["link",e].concat(c),[f,d]}return g=a.match(/^\s*\[(.*?)\]/),g?(f+=g[0].length,e={ref:(g[1]||String(c)).toLowerCase(),original:b.substr(0,f)},d=["link_ref",e].concat(c),[f,d]):1===c.length&&"string"==typeof c[0]?(e={ref:c[0].toLowerCase(),original:b.substr(0,f)},d=["link_ref",
e,c[0]],[f,d]):[1,"["]},"<":function(a){var b;return null!==(b=a.match(/^<(?:((https?|ftp|mailto):[^>]+)|(.*?@.*?\.[a-zA-Z]+))>/))?b[3]?[b[0].length,["link",{href:"mailto:"+b[3]},b[3]]]:"mailto"===b[2]?[b[0].length,["link",{href:b[1]},b[1].substr(7)]]:[b[0].length,["link",{href:b[1]},b[1]]]:[1,"<"]},"`":function(a){return(a=a.match(/(`+)(([\s\S]*?)\1)/))&&a[2]?[a[1].length+a[2].length,["inlinecode",a[3]]]:[1,"`"]},"  \n":function(){return[3,["linebreak"]]}}};l.inline["**"]=s("strong","**");l.inline.__=
s("strong","__");l.inline["*"]=s("em","*");l.inline._=s("em","_");g.dialects.Gruber=l;g.buildBlockOrder(g.dialects.Gruber.block);g.buildInlinePatterns(g.dialects.Gruber.inline);l=v.subclassDialect(l);p=y;z=D;l.processMetaHash=function(a){var b=a.split("");a=[""];for(var c=!1;b.length;){var d=b.shift();switch(d){case " ":c?a[a.length-1]+=d:a.push("");break;case "'":case '"':c=!c;break;case "\\":d=b.shift();default:a[a.length-1]+=d}}b={};for(c=0;c<a.length;++c)/^#/.test(a[c])?b.id=a[c].substring(1):
/^\./.test(a[c])?b["class"]=b["class"]?b["class"]+a[c].replace(/./," "):a[c].substring(1):/\=/.test(a[c])&&(d=a[c].split(/\=/),b[d[0]]=d[1]);return b};l.block.document_meta=function(a){if(!(1<a.lineNumber)&&a.match(/^(?:\w+:.*\n)*\w+:.*$/)){p(this.tree)||this.tree.splice(1,0,{});a=a.split(/\n/);for(var b in a){var c=a[b].match(/(\w+):\s*(.*)$/),d=c[1].toLowerCase();this.tree[1][d]=c[2]}return[]}};l.block.block_meta=function(a){var b=a.match(/(^|\n) {0,3}\{:\s*((?:\\\}|[^\}])*)\s*\}$/);if(b){var c=
this.dialect.processMetaHash(b[2]);if(""===b[1]){b=this.tree[this.tree.length-1];if(a=p(b),"string"==typeof b)return;a||(a={},b.splice(1,0,a));for(var d in c)a[d]=c[d];return[]}a=a.replace(/\n.*$/,"");b=this.processBlock(a,[]);(a=p(b[0]))||(a={},b[0].splice(1,0,a));for(d in c)a[d]=c[d];return b}};l.block.definition_list=function(a,b){var c,d=/^((?:[^\s:].*\n)+):\s+([\s\S]+)$/,e=["dl"];if(a.match(d)){for(var f=[a];b.length&&d.exec(b[0]);)f.push(b.shift());for(var g=0;g<f.length;++g){c=f[g].match(d);
var m=c[1].replace(/\n$/,"").split(/\n/),k=c[2].split(/\n:\s+/);for(c=0;c<m.length;++c)e.push(["dt",m[c]]);for(c=0;c<k.length;++c)e.push(["dd"].concat(this.processInline(k[c].replace(/(\n)\s+/,"$1"))))}return[e]}};l.block.table=function(a){var b,c,d=function(a,b){b=b||"\\s";b.match(/^[\\|\[\]{}?*.+^$]$/)&&(b="\\"+b);for(var c,d=[],e=new RegExp("^((?:\\\\.|[^\\\\"+b+"])*)"+b+"(.*)");c=a.match(e);)d.push(c[1]),a=c[2];return d.push(a),d},e=/^ {0,3}(\S(?:\\.|[^\\|])*\|.*)\n {0,3}([\-:]+\s*\|[\-| :]*)\n((?:(?:\\.|[^\\|])*\|.*(?:\n|$))*)(?=\n|$)/;
if(c=a.match(/^ {0,3}\|(.+)\n {0,3}\|\s*([\-:]+[\-| :]*)\n((?:\s*\|.*(?:\n|$))*)(?=\n|$)/))c[3]=c[3].replace(/^\s*\|/gm,"");else if(!(c=a.match(e)))return;var f=["table",["thead",["tr"]],["tbody"]];c[2]=c[2].replace(/\|\s*$/,"").split("|");var g=[];z(c[2],function(a){a.match(/^\s*-+:\s*$/)?g.push({align:"right"}):a.match(/^\s*:-+\s*$/)?g.push({align:"left"}):a.match(/^\s*:-+:\s*$/)?g.push({align:"center"}):g.push({})});c[1]=d(c[1].replace(/\|\s*$/,""),"|");for(b=0;b<c[1].length;b++)f[1][1].push(["th",
g[b]||{}].concat(this.processInline(c[1][b].trim())));return z(c[3].replace(/\|\s*$/gm,"").split("\n"),function(a){var c=["tr"];a=d(a,"|");for(b=0;b<a.length;b++)c.push(["td",g[b]||{}].concat(this.processInline(a[b].trim())));f[2].push(c)},this),[f]};l.inline["{:"]=function(a,b,c){if(!c.length)return[2,"{:"];b=c[c.length-1];if("string"==typeof b)return[2,"{:"];a=a.match(/^\{:\s*((?:\\\}|[^\}])*)\s*\}/);if(!a)return[2,"{:"];c=this.dialect.processMetaHash(a[1]);var d=p(b);d||(d={},b.splice(1,0,d));
for(var e in c)d[e]=c[e];return[a[0].length,""]};g.dialects.Maruku=l;g.dialects.Maruku.inline.__escape__=/^\\[\\`\*_{}\[\]()#\+.!\-|:]/;g.buildBlockOrder(g.dialects.Maruku.block);g.buildInlinePatterns(g.dialects.Maruku.inline);f.Markdown=g;f.parse=g.parse;f.toHTML=g.toHTML;f.toHTMLTree=g.toHTMLTree;f.renderJsonML=g.renderJsonML}(function(){return window.markdown={},window.markdown}());(function(f){"function"===typeof define&&define.amd?define(["jquery"],f):f(jQuery)})(function(f){var C=0;f.fn.markdownEditor=function(e,m){return{init:f.proxy(f.fn.markdownEditor.init,this),destroy:f.proxy(f.fn.markdownEditor.destroy,this),getHTML:f.proxy(f.fn.markdownEditor.getHTML,this),getMarkdown:f.proxy(f.fn.markdownEditor.getMarkdown,this),setValue:f.proxy(f.fn.markdownEditor.setValue,this),addButton:f.proxy(f.fn.markdownEditor.addButton,this),addComponent:f.proxy(f.fn.markdownEditor.addComponent,
this),getSelection:f.proxy(f.fn.markdownEditor.getSelection,this),insertValueAtCursor:f.proxy(f.fn.markdownEditor.insertValueAtCursor,this)}[e](m)};f.fn.markdownEditor.init=function(e){e=new f.fn.markdownEditor.MarkdownEditor(this,e);e.render();this.data("markdownEditor",e);return this};f.fn.markdownEditor.destroy=function(){this.data("markdownEditor").destroy();this.removeData("markdownEditor")};f.fn.markdownEditor.getHTML=function(){return this.data("markdownEditor").getHTML()};f.fn.markdownEditor.getMarkdown=
function(){return this.data("markdownEditor").getMarkdown()};f.fn.markdownEditor.setValue=function(e){this.data("markdownEditor").setValue(e);return this};f.fn.markdownEditor.addButton=function(e){this.data("markdownEditor").addButton(e);return this};f.fn.markdownEditor.addComponent=function(e){return this.data("markdownEditor").addComponent(e)};f.fn.markdownEditor.getSelection=function(){return this.data("markdownEditor").getSelection()};f.fn.markdownEditor.insertValueAtCursor=function(e){this.data("markdownEditor").insertValueAtCursor(e);
return this};f.fn.markdownEditor.MarkdownEditor=function(e,f){this.setupEl(e);this.setupOptions(f);this.initialize()};f.extend(f.fn.markdownEditor.MarkdownEditor.prototype,{id:void 0,$textarea:void 0,$preview:void 0,$buttonBar:void 0,$el:void 0,options:void 0,_buttonBold:function(e){return"**"+e+"**"},_buttonItalic:function(e){return"*"+e+"*"},_buttonUnderline:function(e){return"_"+e+"_"},_buttonClick:function(e){var f=this.getSelection();e&&(e=e(f.selection),this.insertValueAtCursor(e))},_defaultButtons:function(){return[{label:"B",
name:"bold",functionality:this._buttonBold},{label:"I",name:"italic",functionality:this._buttonItalic},{label:"U",name:"underline",functionality:this._buttonUnderline}]},_updatePreview:function(){var e=this.$textarea.val(),m=/!!!UNIQUE_TOKEN!!!/,e=f("<div />").append(e),k=[],n;e.first().contents().each(function(){1===this.nodeType&&(k.push(f(this).clone().wrap("<p>").parent().html()),f(this).replaceWith("!!!UNIQUE_TOKEN!!!"))});for(n=markdown.toHTML(e.html());k.length;)e=k.shift(),n=n.replace(m,e);
this.$preview.html(n)},_createColumn:function(e){var m=f('<div class="md-column" />');e&&m.append(e);return m},_textareaBehavior:function(e){if(9===e.keyCode){var f=e.target.selectionStart,k=e.target.selectionEnd,n=this.$textarea.val();this.$textarea.val(n.substring(0,f)+"\t"+n.substring(k));e.target.selectionStart=e.target.selectionEnd=f+1;e.preventDefault()}},_buildButton:function(e){var m=f('<button type="button">'+e.label+"</button>");(functionality=e.functionality)&&m.click(f.proxy(this._buttonClick,
this,functionality));this.$buttonBar.append(m)},_buildButtonBar:function(){var e=this._defaultButtons(),f=e.length,k;for(k=0;k<f;k++)this._buildButton(e[k])},setupOptions:function(e){this.options={initString:void 0,markdownAttrs:void 0,previewAttrs:void 0};f.extend(this.options,e||{})},setupEl:function(e){this.$el=e},initialize:function(){this.id="md"+C++;this.options.initString=this.options.initString||decodeURI(this.$el.html())},render:function(){var e=f.proxy(this._updatePreview,this),m;this.$el.addClass("md-markdown-editor");
this.$textarea=f("<textarea />").val(this.options.initString);this.$buttonBar=f('<div class="md-button-bar" />');this.$preview=f('<div class="md-preview" />');this.$el.empty();this._buildButtonBar();m=this._createColumn();m.append(this.$buttonBar);m.append(this.$textarea);this.$el.append(m).append(this._createColumn(this.$preview));this.options.markdownAttrs&&this.$textarea.attr(this.options.markdownAttrs);this.options.previewAttrs&&this.$textarea.attr(this.options.previewAttrs);this.$textarea.on("input",
e).on("keyup",e).on("keydown",e);this.$textarea.keydown(f.proxy(this._textareaBehavior,this));this._updatePreview();return this},destroy:function(){this.$preview.remove();this.$preview=void 0;this.$textarea.remove();this.$textarea=void 0;this.$el.remove();this.$el=void 0},getMarkdown:function(){return this.$textarea.val()},getHTML:function(){return this.$preview.html()},setValue:function(e){this.$textarea.val(e);this._updatePreview();return this},addButton:function(e){this._buildButton(e);return this},
addComponent:function(e){this.$buttonBar.append(e)},getSelection:function(){var e,f,k;e=this.$textarea.val();f=this.$textarea[0].selectionStart;k=this.$textarea[0].selectionEnd;e=e.substring(f,k);return{start:f,end:k,selection:e}},insertValueAtCursor:function(e){var f,k,n,t;e&&(n=this.$textarea.val(),k=this.getSelection(),f=k.start||0,k=k.end||0,n=n.substring(0,f)+e+n.substring(k,n.length),this.$textarea.val(n),t=f+e.length,this.$textarea.focus(),this.$textarea.each(function(e,f){f.setSelectionRange(t,
t)}),this._updatePreview())}})});
