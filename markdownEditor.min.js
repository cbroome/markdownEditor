!function(g){function e(){return"Markdown.mk_block( "+uneval(this.toString())+", "+uneval(this.trailing)+", "+uneval(this.lineNumber)+" )"}function l(){var a=require("util");return"Markdown.mk_block( "+a.inspect(this.toString())+", "+a.inspect(this.trailing)+", "+a.inspect(this.lineNumber)+" )"}function m(a){for(var b=0,c=-1;-1!==(c=a.indexOf("\n",c+1));)b++;return b}function k(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}
function t(a){if("string"==typeof a)return k(a);var b=a.shift(),c={},d=[];for(!a.length||"object"!=typeof a[0]||a[0]instanceof Array||(c=a.shift());a.length;)d.push(t(a.shift()));a="";for(var f in c)a+=" "+f+'="'+k(c[f])+'"';return"img"===b||"br"===b||"hr"===b?"<"+b+a+"/>":"<"+b+a+">"+d.join("")+"</"+b+">"}function G(a,b,c){var d;c=c||{};a=a.slice(0);"function"==typeof c.preprocessTreeNode&&(a=c.preprocessTreeNode(a,b));var f=p(a);if(f){a[1]={};for(d in f)a[1][d]=f[d];f=a[1]}if("string"==typeof a)return a;
switch(a[0]){case "header":a[0]="h"+a[1].level;delete a[1].level;break;case "bulletlist":a[0]="ul";break;case "numberlist":a[0]="ol";break;case "listitem":a[0]="li";break;case "para":a[0]="p";break;case "markdown":a[0]="html";f&&delete f.references;break;case "code_block":a[0]="pre";d=f?2:1;var E=["code"];E.push.apply(E,a.splice(d,a.length-d));a[d]=E;break;case "inlinecode":a[0]="code";break;case "img":a[1].src=a[1].href;delete a[1].href;break;case "linebreak":a[0]="br";break;case "link":a[0]="a";
break;case "link_ref":a[0]="a";d=b[f.ref];if(!d)return f.original;delete f.ref;f.href=d.href;d.title&&(f.title=d.title);delete f.original;break;case "img_ref":a[0]="img";d=b[f.ref];if(!d)return f.original;delete f.ref;f.src=d.href;d.title&&(f.title=d.title);delete f.original}if(d=1,f){for(var e in a[1]){d=2;break}1===d&&a.splice(d,1)}for(;d<a.length;++d)a[d]=G(a[d],b,c);return a}function A(a){for(var b=p(a)?2:1;b<a.length;)"string"==typeof a[b]?b+1<a.length&&"string"==typeof a[b+1]?a[b]+=a.splice(b+
1,1)[0]:++b:(A(a[b]),++b)}function B(a,b){function c(a){this.len_after=a;this.name="close_"+b}var d=a+"_state",f="strong"===a?"em_state":"strong_state";return function(e){if(this[d][0]===b)return this[d].shift(),[e.length,new c(e.length-b.length)];var g=this[f].slice(),h=this[d].slice();this[d].unshift(b);var C=this.processInline(e.substr(b.length)),l=C[C.length-1];return(this[d].shift(),l instanceof c)?(C.pop(),[e.length-l.len_after,[a].concat(C)]):(this[f]=g,this[d]=h,[b.length,b])}}var n,u,F,D;
n=function(a,b,c){1===arguments.length&&(b="\n\n");var d=new String(a);return d.trailing=b,d.inspect=l,d.toSource=e,void 0!==c&&(d.lineNumber=c),d};var v=u=Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)};F=Array.prototype.forEach?function(a,b,c){return a.forEach(b,c)}:function(a,b,c){for(var d=0;d<a.length;d++)b.call(c||a,a[d],d,a)};D=function(a){return v(a)&&1<a.length&&"object"==typeof a[1]&&!v(a[1])?a[1]:void 0};var h=function(a){switch(typeof a){case "undefined":this.dialect=
h.dialects.Gruber;break;case "object":this.dialect=a;break;default:if(!(a in h.dialects))throw Error("Unknown Markdown dialect '"+String(a)+"'");this.dialect=h.dialects[a]}this.em_state=[];this.strong_state=[];this.debug_indent=""};h.dialects={};var q=h.mk_block=n,v=u;h.parse=function(a,b){return(new h(b)).toTree(a)};h.prototype.split_blocks=function(a){a=a.replace(/(\r\n|\n|\r)/g,"\n");var b,c=/([\s\S]+?)($|\n#|\n(?:\s*\n|$)+)/g,d=[],f=1;for(null!==(b=/^(\s*\n)/.exec(a))&&(f+=m(b[0]),c.lastIndex=
b[0].length);null!==(b=c.exec(a));)"\n#"===b[2]&&(b[2]="\n",c.lastIndex--),d.push(q(b[1],b[2],f)),f+=m(b[0]);return d};h.prototype.processBlock=function(a,b){var c=this.dialect.block,d=c.__order__;if("__call__"in c)return c.__call__.call(this,a,b);for(var f=0;f<d.length;f++){var e=c[d[f]].call(this,a,b);if(e)return(!v(e)||0<e.length&&!v(e[0]))&&this.debug(d[f],"didn't return a proper array"),e}return[]};h.prototype.processInline=function(a){return this.dialect.inline.__call__.call(this,String(a))};
h.prototype.toTree=function(a,b){var c=a instanceof Array?a:this.split_blocks(a),d=this.tree;try{for(this.tree=b||this.tree||["markdown"];c.length;){var f=this.processBlock(c.shift(),c);f.length&&this.tree.push.apply(this.tree,f)}return this.tree}finally{b&&(this.tree=d)}};h.prototype.debug=function(){var a=Array.prototype.slice.call(arguments);a.unshift(this.debug_indent);"undefined"!=typeof print&&print.apply(print,a);"undefined"!=typeof console&&"undefined"!=typeof console.log&&console.log.apply(null,
a)};h.prototype.loop_re_over_block=function(a,b,c){var d;for(b=b.valueOf();b.length&&null!==(d=a.exec(b));)b=b.substr(d[0].length),c.call(this,d);return b};h.buildBlockOrder=function(a){var b=[],c;for(c in a)"__order__"!==c&&"__call__"!==c&&b.push(c);a.__order__=b};h.buildInlinePatterns=function(a){var b=[],c;for(c in a)if(!c.match(/^__.*__$/)){var d=c.replace(/([\\.*+?|()\[\]{}])/g,"\\$1").replace(/\n/,"\\n");b.push(1===c.length?d:"(?:"+d+")")}b=b.join("|");a.__patterns__=b;var f=a.__call__;a.__call__=
function(a,c){return void 0!==c?f.call(this,a,c):f.call(this,a,b)}};var p=D;h.renderJsonML=function(a,b){b=b||{};b.root=b.root||!1;var c=[];if(b.root)c.push(t(a));else for(a.shift(),!a.length||"object"!=typeof a[0]||a[0]instanceof Array||a.shift();a.length;)c.push(t(a.shift()));return c.join("\n\n")};h.toHTMLTree=function(a,b,c){"string"==typeof a&&(a=this.parse(a,b));b=p(a);var d={};b&&b.references&&(d=b.references);a=G(a,d,c);return A(a),a};h.toHTML=function(a,b,c){a=this.toHTMLTree(a,b,c);return this.renderJsonML(a)};
u={inline_until_char:function(a,b){for(var c=0,d=[];;){if(a.charAt(c)===b)return c++,[c,d];if(c>=a.length)return null;var f=this.dialect.inline.__oneElement__.call(this,a.substr(c)),c=c+f[0];d.push.apply(d,f.slice(1))}},subclassDialect:function(a){function b(){}function c(){}return b.prototype=a.block,c.prototype=a.inline,{block:new b,inline:new c}}};var x=F,p=D,q=n,H=u.inline_until_char;n={block:{atxHeader:function(a,b){var c=a.match(/^(#{1,6})\s*(.*?)\s*#*\s*(?:\n|$)/);if(c){var d=["header",{level:c[1].length}];
return Array.prototype.push.apply(d,this.processInline(c[2])),c[0].length<a.length&&b.unshift(q(a.substr(c[0].length),a.trailing,a.lineNumber+2)),[d]}},setextHeader:function(a,b){var c=a.match(/^(.*)\n([-=])\2\2+(?:\n|$)/);if(c){var d=["header",{level:"="===c[2]?1:2},c[1]];return c[0].length<a.length&&b.unshift(q(a.substr(c[0].length),a.trailing,a.lineNumber+2)),[d]}},code:function(a,b){var c=[],d=/^(?: {0,3}\t| {4})(.*)\n?/;if(a.match(d)){a:for(;;){var f=this.loop_re_over_block(d,a.valueOf(),function(a){c.push(a[1])});
if(f.length){b.unshift(q(f,a.trailing));break a}if(!b.length)break a;if(!b[0].match(d))break a;c.push(a.trailing.replace(/[^\n]/g,"").substring(2));a=b.shift()}return[["code_block",c.join("\n")]]}},horizRule:function(a,b){var c=a.match(/^(?:([\s\S]*?)\n)?[ \t]*([-_*])(?:[ \t]*\2){2,}[ \t]*(?:\n([\s\S]*))?$/);if(c){var d=[["hr"]];if(c[1]){var f=q(c[1],"",a.lineNumber);d.unshift.apply(d,this.toTree(f,[]))}return c[3]&&b.unshift(q(c[3],a.trailing,a.lineNumber+1)),d}},lists:function(){function a(a){return new RegExp("(?:^("+
h+"{0,"+a+"} {0,3})("+f+")\\s+)|(^"+h+"{0,"+(a-1)+"}[ ]{0,4})")}function b(a,b,c,d){if(b)return a.push(["para"].concat(c)),void 0;b=a[a.length-1]instanceof Array&&"para"===a[a.length-1][0]?a[a.length-1]:a;d&&1<a.length&&c.unshift(d);for(a=0;a<c.length;a++)d=c[a],"string"==typeof d&&1<b.length&&"string"==typeof b[b.length-1]?b[b.length-1]+=d:b.push(d)}function c(a,b){for(var c=new RegExp("^("+h+"{"+a+"}.*?\\n?)*$"),d=new RegExp("^"+h+"{"+a+"}","gm"),f=[];0<b.length&&c.exec(b[0]);){var e=b.shift(),
g=e.replace(d,"");f.push(q(g,e.trailing,e.lineNumber))}return f}function d(a,b,c){a=a.list;a=a[a.length-1];a[1]instanceof Array&&"para"===a[1][0]||(b+1===c.length?a.push(["para"].concat(a.splice(1,a.length-1))):(b=a.pop(),a.push(["para"].concat(a.splice(1,a.length-1)),b)))}var f="[*+-]|\\d+\\.",e=/[*+-]/,g=new RegExp("^( {0,3})("+f+")[ \t]+"),h="(?: {0,3}\\t| {4})";return function(f,h){function l(a){var b=e.exec(a[2])?["bulletlist"]:["numberlist"];return k.push({list:b,indent:a[1]}),b}var s=f.match(g);
if(s){for(var m,n,k=[],p=l(s),r=!1,q=[k[0].list];;){for(var t=f.split(/(?=\n)/),w="",y="",u=0;u<t.length;u++){var y="",v=t[u].replace(/^\n/,function(a){return y=a,""});n=a(k.length);if(s=v.match(n),void 0!==s[1]){w.length&&(b(m,r,this.processInline(w),y),r=!1,w="");s[1]=s[1].replace(/ {0,3}\t/g,"    ");var z=Math.floor(s[1].length/4)+1;if(z>k.length)p=l(s),m.push(p),m=p[1]=["listitem"];else{var A=!1;for(n=0;n<k.length;n++)if(k[n].indent===s[1]){p=k[n].list;k.splice(n+1,k.length-(n+1));A=!0;break}A||
(z++,z<=k.length?(k.splice(z,k.length-z),p=k[z-1].list):(p=l(s),m.push(p)));m=["listitem"];p.push(m)}y=""}v.length>s[0].length&&(w+=y+v.substr(s[0].length))}w.length&&(b(m,r,this.processInline(w),y),r=!1,w="");r=c(k.length,h);0<r.length&&(x(k,d,this),m.push.apply(m,this.toTree(r,[])));r=h[0]&&h[0].valueOf()||"";if(!r.match(g)&&!r.match(/^ /))break;f=h.shift();if(r=this.dialect.block.horizRule(f,h)){q.push.apply(q,r);break}x(k,d,this);r=!0}return q}}}(),blockquote:function(a,b){if(a.match(/^>/m)){var c=
[];if(">"!==a[0]){for(var d=a.split(/\n/),f=[],e=a.lineNumber;d.length&&">"!==d[0][0];)f.push(d.shift()),e++;f=q(f.join("\n"),"\n",a.lineNumber);c.push.apply(c,this.processBlock(f,[]));a=q(d.join("\n"),a.trailing,e)}for(;b.length&&">"===b[0][0];)d=b.shift(),a=q(a+a.trailing+d,d.trailing,a.lineNumber);d=a.replace(/^> ?/gm,"");d=(this.tree,this.toTree(d,["blockquote"]));if((e=p(d))&&e.references){delete e.references;var g;a:{for(g in e)if(hasOwnProperty.call(e,g)){g=!1;break a}g=!0}g&&d.splice(1,1)}return c.push(d),
c}},referenceDefn:function(a,b){var c=/^\s*\[(.*?)\]:\s*(\S+)(?:\s+(?:(['"])(.*?)\3|\((.*?)\)))?\n?/;if(a.match(c)){p(this.tree)||this.tree.splice(1,0,{});var d=p(this.tree);void 0===d.references&&(d.references={});c=this.loop_re_over_block(c,a,function(a){a[2]&&"<"===a[2][0]&&">"===a[2][a[2].length-1]&&(a[2]=a[2].substring(1,a[2].length-1));var b=d.references[a[1].toLowerCase()]={href:a[2]};void 0!==a[4]?b.title=a[4]:void 0!==a[5]&&(b.title=a[5])});return c.length&&b.unshift(q(c,a.trailing)),[]}},
para:function(a){return[["para"].concat(this.processInline(a))]}},inline:{__oneElement__:function(a,b,c){var d,f;b=b||this.dialect.inline.__patterns__;return(d=(new RegExp("([\\s\\S]*?)("+(b.source||b)+")")).exec(a),d)?d[1]?[d[1].length,d[1]]:(d[2]in this.dialect.inline&&(f=this.dialect.inline[d[2]].call(this,a.substr(d.index),d,c||[])),f||[d[2].length,d[2]]):[a.length,a]},__call__:function(a,b){function c(a){"string"==typeof a&&"string"==typeof f[f.length-1]?f[f.length-1]+=a:f.push(a)}for(var d,
f=[];0<a.length;)d=this.dialect.inline.__oneElement__.call(this,a,b,f),a=a.substr(d.shift()),x(d,c);return f},"]":function(){},"}":function(){},__escape__:/^\\[\\`\*_{}\[\]()#\+.!\-]/,"\\":function(a){return this.dialect.inline.__escape__.exec(a)?[2,a.charAt(1)]:[1,"\\"]},"![":function(a){var b=a.match(/^!\[(.*?)\][ \t]*\([ \t]*([^")]*?)(?:[ \t]+(["'])(.*?)\3)?[ \t]*\)/);return b?(b[2]&&"<"===b[2][0]&&">"===b[2][b[2].length-1]&&(b[2]=b[2].substring(1,b[2].length-1)),b[2]=this.dialect.inline.__call__.call(this,
b[2],/\\/)[0],a={alt:b[1],href:b[2]||""},void 0!==b[4]&&(a.title=b[4]),[b[0].length,["img",a]]):(b=a.match(/^!\[(.*?)\][ \t]*\[(.*?)\]/),b?[b[0].length,["img_ref",{alt:b[1],ref:b[2].toLowerCase(),original:b[0]}]]:[2,"!["])},"[":function(a){var b=String(a),c=H.call(this,a.substr(1),"]");if(!c)return[1,"["];var d,f,e=1+c[0],c=c[1];a=a.substr(e);var g=a.match(/^\s*\([ \t]*([^"']*)(?:[ \t]+(["'])(.*?)\2)?[ \t]*\)/);if(g){a=g[1];if(e+=g[0].length,a&&"<"===a[0]&&">"===a[a.length-1]&&(a=a.substring(1,a.length-
1)),!g[3])for(var b=1,h=0;h<a.length;h++)switch(a[h]){case "(":b++;break;case ")":0===--b&&(e-=a.length-h,a=a.substring(0,h))}return a=this.dialect.inline.__call__.call(this,a,/\\/)[0],f={href:a||""},void 0!==g[3]&&(f.title=g[3]),d=["link",f].concat(c),[e,d]}return g=a.match(/^\s*\[(.*?)\]/),g?(e+=g[0].length,f={ref:(g[1]||String(c)).toLowerCase(),original:b.substr(0,e)},d=["link_ref",f].concat(c),[e,d]):1===c.length&&"string"==typeof c[0]?(f={ref:c[0].toLowerCase(),original:b.substr(0,e)},d=["link_ref",
f,c[0]],[e,d]):[1,"["]},"<":function(a){var b;return null!==(b=a.match(/^<(?:((https?|ftp|mailto):[^>]+)|(.*?@.*?\.[a-zA-Z]+))>/))?b[3]?[b[0].length,["link",{href:"mailto:"+b[3]},b[3]]]:"mailto"===b[2]?[b[0].length,["link",{href:b[1]},b[1].substr(7)]]:[b[0].length,["link",{href:b[1]},b[1]]]:[1,"<"]},"`":function(a){return(a=a.match(/(`+)(([\s\S]*?)\1)/))&&a[2]?[a[1].length+a[2].length,["inlinecode",a[3]]]:[1,"`"]},"  \n":function(){return[3,["linebreak"]]}}};n.inline["**"]=B("strong","**");n.inline.__=
B("strong","__");n.inline["*"]=B("em","*");n.inline._=B("em","_");h.dialects.Gruber=n;h.buildBlockOrder(h.dialects.Gruber.block);h.buildInlinePatterns(h.dialects.Gruber.inline);n=u.subclassDialect(n);p=D;x=F;n.processMetaHash=function(a){var b=a.split("");a=[""];for(var c=!1;b.length;){var d=b.shift();switch(d){case " ":c?a[a.length-1]+=d:a.push("");break;case "'":case '"':c=!c;break;case "\\":d=b.shift();default:a[a.length-1]+=d}}b={};for(c=0;c<a.length;++c)/^#/.test(a[c])?b.id=a[c].substring(1):
/^\./.test(a[c])?b["class"]=b["class"]?b["class"]+a[c].replace(/./," "):a[c].substring(1):/\=/.test(a[c])&&(d=a[c].split(/\=/),b[d[0]]=d[1]);return b};n.block.document_meta=function(a){if(!(1<a.lineNumber)&&a.match(/^(?:\w+:.*\n)*\w+:.*$/)){p(this.tree)||this.tree.splice(1,0,{});a=a.split(/\n/);for(var b in a){var c=a[b].match(/(\w+):\s*(.*)$/),d=c[1].toLowerCase();this.tree[1][d]=c[2]}return[]}};n.block.block_meta=function(a){var b=a.match(/(^|\n) {0,3}\{:\s*((?:\\\}|[^\}])*)\s*\}$/);if(b){var c=
this.dialect.processMetaHash(b[2]);if(""===b[1]){b=this.tree[this.tree.length-1];if(a=p(b),"string"==typeof b)return;a||(a={},b.splice(1,0,a));for(var d in c)a[d]=c[d];return[]}a=a.replace(/\n.*$/,"");b=this.processBlock(a,[]);(a=p(b[0]))||(a={},b[0].splice(1,0,a));for(d in c)a[d]=c[d];return b}};n.block.definition_list=function(a,b){var c,d=/^((?:[^\s:].*\n)+):\s+([\s\S]+)$/,f=["dl"];if(a.match(d)){for(var e=[a];b.length&&d.exec(b[0]);)e.push(b.shift());for(var g=0;g<e.length;++g){c=e[g].match(d);
var h=c[1].replace(/\n$/,"").split(/\n/),l=c[2].split(/\n:\s+/);for(c=0;c<h.length;++c)f.push(["dt",h[c]]);for(c=0;c<l.length;++c)f.push(["dd"].concat(this.processInline(l[c].replace(/(\n)\s+/,"$1"))))}return[f]}};n.block.table=function(a){var b,c,d=function(a,b){b=b||"\\s";b.match(/^[\\|\[\]{}?*.+^$]$/)&&(b="\\"+b);for(var c,d=[],e=new RegExp("^((?:\\\\.|[^\\\\"+b+"])*)"+b+"(.*)");c=a.match(e);)d.push(c[1]),a=c[2];return d.push(a),d},e=/^ {0,3}(\S(?:\\.|[^\\|])*\|.*)\n {0,3}([\-:]+\s*\|[\-| :]*)\n((?:(?:\\.|[^\\|])*\|.*(?:\n|$))*)(?=\n|$)/;
if(c=a.match(/^ {0,3}\|(.+)\n {0,3}\|\s*([\-:]+[\-| :]*)\n((?:\s*\|.*(?:\n|$))*)(?=\n|$)/))c[3]=c[3].replace(/^\s*\|/gm,"");else if(!(c=a.match(e)))return;var g=["table",["thead",["tr"]],["tbody"]];c[2]=c[2].replace(/\|\s*$/,"").split("|");var h=[];x(c[2],function(a){a.match(/^\s*-+:\s*$/)?h.push({align:"right"}):a.match(/^\s*:-+\s*$/)?h.push({align:"left"}):a.match(/^\s*:-+:\s*$/)?h.push({align:"center"}):h.push({})});c[1]=d(c[1].replace(/\|\s*$/,""),"|");for(b=0;b<c[1].length;b++)g[1][1].push(["th",
h[b]||{}].concat(this.processInline(c[1][b].trim())));return x(c[3].replace(/\|\s*$/gm,"").split("\n"),function(a){var c=["tr"];a=d(a,"|");for(b=0;b<a.length;b++)c.push(["td",h[b]||{}].concat(this.processInline(a[b].trim())));g[2].push(c)},this),[g]};n.inline["{:"]=function(a,b,c){if(!c.length)return[2,"{:"];b=c[c.length-1];if("string"==typeof b)return[2,"{:"];a=a.match(/^\{:\s*((?:\\\}|[^\}])*)\s*\}/);if(!a)return[2,"{:"];c=this.dialect.processMetaHash(a[1]);var d=p(b);d||(d={},b.splice(1,0,d));
for(var e in c)d[e]=c[e];return[a[0].length,""]};h.dialects.Maruku=n;h.dialects.Maruku.inline.__escape__=/^\\[\\`\*_{}\[\]()#\+.!\-|:]/;h.buildBlockOrder(h.dialects.Maruku.block);h.buildInlinePatterns(h.dialects.Maruku.inline);g.Markdown=h;g.parse=h.parse;g.toHTML=h.toHTML;g.toHTMLTree=h.toHTMLTree;g.renderJsonML=h.renderJsonML}(function(){return window.markdown={},window.markdown}());(function(g){"function"===typeof define&&define.amd?define(["jquery"],g):g(jQuery)})(function(g){g.fn.markdownEditor=function(e,l){return{init:g.proxy(g.fn.markdownEditor.init,this),getHTML:g.proxy(g.fn.markdownEditor.getHTML,this),getMarkdown:g.proxy(g.fn.markdownEditor.getMarkdown,this),setValue:g.proxy(g.fn.markdownEditor.setValue,this),addButton:g.proxy(g.fn.markdownEditor.addButton,this)}[e](l)};g.fn.markdownEditor.init=function(e){var l=g(this);e=new g.fn.markdownEditor.MarkdownEditor(l,e);
e.render();l.data("markdownEditor",e);return this};g.fn.markdownEditor.getHTML=function(){return g(this).data("markdownEditor").getHTML()};g.fn.markdownEditor.getMarkdown=function(){return g(this).data("markdownEditor").getMarkdown()};g.fn.markdownEditor.setValue=function(e){return g(this).data("markdownEditor").setValue(e)};g.fn.markdownEditor.addButton=function(e){return g(this).data("markdownEditor").addButton(e)};g.fn.markdownEditor.MarkdownEditor=function(e,l){this.$el=e;g.extend(this.options,
l||{});this.initialize()};g.extend(g.fn.markdownEditor.MarkdownEditor.prototype,{$textarea:void 0,$preview:void 0,$buttonBar:void 0,options:{initString:void 0,markdownAttrs:void 0,previewAttrs:void 0},_buttonBold:function(e){return"**"+e+"**"},_buttonItalic:function(e){return"*"+e+"*"},_buttonUnderline:function(e){return"_"+e+"_"},_buttonClick:function(e){var g,m,k,t;e&&(k=this.$textarea.val(),g=this.$textarea[0].selectionStart,m=this.$textarea[0].selectionEnd,e=e(k.substring(g,m)))&&(m=k.substring(0,
g)+e+k.substring(m,k.length),this.$textarea.val(m),t=g+e.length,this.$textarea.focus(),this.$textarea.each(function(e,g){g.setSelectionRange(t,t)}),this._updatePreview())},_defaultButtons:function(){return[{label:"B",name:"bold",functionality:this._buttonBold},{label:"I",name:"italic",functionality:this._buttonItalic},{label:"U",name:"underline",functionality:this._buttonUnderline}]},_updatePreview:function(){var e=this.$textarea.val(),l=/!!!UNIQUE_TOKEN!!!/,e=g("<div />").append(e),m=[],k;e.first().contents().each(function(){1===
this.nodeType&&(m.push(g(this).clone().wrap("<p>").parent().html()),g(this).replaceWith("!!!UNIQUE_TOKEN!!!"))});for(k=markdown.toHTML(e.html());m.length;)e=m.shift(),k=k.replace(l,e);this.$preview.html(k)},_createColumn:function(e){var l=g('<div class="md-column" />');e&&l.append(e);return l},_textareaBehavior:function(e){if(9===e.keyCode){var g=e.target.selectionStart,m=e.target.selectionEnd,k=this.$textarea.val();this.$textarea.val(k.substring(0,g)+"\t"+k.substring(m));e.target.selectionStart=
e.target.selectionEnd=g+1;e.preventDefault()}},_buildButton:function(e){var l=g('<button type="button">'+e.label+"</button>");(functionality=e.functionality)&&l.click(g.proxy(this._buttonClick,this,functionality));this.$buttonBar.append(l)},_buildButtonBar:function(){var e=this._defaultButtons(),g=e.length,m;for(m=0;m<g;m++)this._buildButton(e[m])},initialize:function(){this.options.initString=this.options.initString||decodeURI(this.$el.html())},render:function(){var e=g.proxy(this._updatePreview,
this),l;this.$el.addClass("md-markdown-editor");this.$textarea=g("<textarea />").val(this.options.initString);this.$buttonBar=g('<div class="md-button-bar" />');this.$preview=g('<div class="md-preview" />');this.$el.empty();this._buildButtonBar();l=this._createColumn();l.append(this.$buttonBar);l.append(this.$textarea);this.$el.append(l).append(this._createColumn(this.$preview));this.options.markdownAttrs&&this.$textarea.attr(this.options.markdownAttrs);this.options.previewAttrs&&this.$textarea.attr(this.options.previewAttrs);
this.$textarea.on("input",e).on("keyup",e).on("keydown",e);this.$textarea.keydown(g.proxy(this._textareaBehavior,this));this._updatePreview();return this},getMarkdown:function(){return this.$textarea.val()},getHTML:function(){return this.$preview.html()},setValue:function(e){this.$textarea.val(e);this._updatePreview();return this},addButton:function(e){this._buildButton(e);return this}})});
